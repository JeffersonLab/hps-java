<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="" lang="">
<head><meta http-equiv="content-type" content="text/html; charset=UTF-8" />
<title>ClusterHitTCorrDriver xref</title>
<link type="text/css" rel="stylesheet" href="../../../../../stylesheet.css" />
</head>
<body>
<div id="overview"><a href="../../../../../../apidocs/org/hps/recon/ecal/cluster/ClusterHitTCorrDriver.html">View Javadoc</a></div><pre>
<a class="jxr_linenumber" name="L1" href="#L1">1</a>   <strong class="jxr_keyword">package</strong> org.hps.recon.ecal.cluster;
<a class="jxr_linenumber" name="L2" href="#L2">2</a>   
<a class="jxr_linenumber" name="L3" href="#L3">3</a>   <strong class="jxr_keyword">import</strong> java.util.List;
<a class="jxr_linenumber" name="L4" href="#L4">4</a>   
<a class="jxr_linenumber" name="L5" href="#L5">5</a>   <strong class="jxr_keyword">import</strong> org.lcsim.event.CalorimeterHit;
<a class="jxr_linenumber" name="L6" href="#L6">6</a>   <strong class="jxr_keyword">import</strong> org.lcsim.event.EventHeader;
<a class="jxr_linenumber" name="L7" href="#L7">7</a>   <strong class="jxr_keyword">import</strong> org.lcsim.event.base.BaseCalorimeterHit;
<a class="jxr_linenumber" name="L8" href="#L8">8</a>   <strong class="jxr_keyword">import</strong> org.lcsim.util.Driver;
<a class="jxr_linenumber" name="L9" href="#L9">9</a>   
<a class="jxr_linenumber" name="L10" href="#L10">10</a>  <em class="jxr_javadoccomment">/**</em>
<a class="jxr_linenumber" name="L11" href="#L11">11</a>  <em class="jxr_javadoccomment"> * This driver specifically alters the time offsets of each crystal for 2015 data relative to pass 6. This is done</em>
<a class="jxr_linenumber" name="L12" href="#L12">12</a>  <em class="jxr_javadoccomment"> * because the original calibration had a few crystals that were out of time and was calibrated with the first RF</em>
<a class="jxr_linenumber" name="L13" href="#L13">13</a>  <em class="jxr_javadoccomment"> * signal. These offsets make all crystals relative to the second rf time which is used to set the event time for a</em>
<a class="jxr_linenumber" name="L14" href="#L14">14</a>  <em class="jxr_javadoccomment"> * triggered cluster. TODO: This should be combined with pass6 and put into the database after the final tweak pass is</em>
<a class="jxr_linenumber" name="L15" href="#L15">15</a>  <em class="jxr_javadoccomment"> * complete.</em>
<a class="jxr_linenumber" name="L16" href="#L16">16</a>  <em class="jxr_javadoccomment"> */</em>
<a class="jxr_linenumber" name="L17" href="#L17">17</a>  <strong class="jxr_keyword">public</strong> <strong class="jxr_keyword">class</strong> <a name="ClusterHitTCorrDriver" href="../../../../../org/hps/recon/ecal/cluster/ClusterHitTCorrDriver.html#ClusterHitTCorrDriver">ClusterHitTCorrDriver</a> <strong class="jxr_keyword">extends</strong> Driver {
<a class="jxr_linenumber" name="L18" href="#L18">18</a>  
<a class="jxr_linenumber" name="L19" href="#L19">19</a>      <em class="jxr_comment">// These offsets are relative to what was used from the database for pass6</em>
<a class="jxr_linenumber" name="L20" href="#L20">20</a>      <em class="jxr_comment">// ix+23, by iy+5. If in top, subtract 1 from iy. If in right, subtract 1 from ix.</em>
<a class="jxr_linenumber" name="L21" href="#L21">21</a>      <strong class="jxr_keyword">private</strong> <strong class="jxr_keyword">static</strong> <strong class="jxr_keyword">final</strong> <strong class="jxr_keyword">double</strong>[][] OFFSETS = {
<a class="jxr_linenumber" name="L22" href="#L22">22</a>              {0.731636, -0.1625, -0.1100132, -0.2097527, -0.070508, -0.0985568, 0.03064861, 0.0659009, -0.0809285,
<a class="jxr_linenumber" name="L23" href="#L23">23</a>                      -0.155452, 0.0771659, -0.1182397, -0.3471135, 0.1241333, 0.2765786, 0.0183527, -0.1502422,
<a class="jxr_linenumber" name="L24" href="#L24">24</a>                      -0.31602266, -0.2979307, -0.247525, 0.1731786, 0.0325443, 0.1852708, -0.1025, 0.127856, 0.1908519,
<a class="jxr_linenumber" name="L25" href="#L25">25</a>                      -0.1184372, -0.1757908, 0.15461859, -0.0424439, 0.0975, 0.008791, -0.1794873, -0.1065643,
<a class="jxr_linenumber" name="L26" href="#L26">26</a>                      -0.2373617, -0.0575, -0.2476379, -0.2075, -0.2575, -0.1051946, -0.1905678, 0.1225, -0.6327995,
<a class="jxr_linenumber" name="L27" href="#L27">27</a>                      -0.20606285, 0.7225, -1.6225},
<a class="jxr_linenumber" name="L28" href="#L28">28</a>              {-0.804537, -0.2575, -0.2025, -0.0807391, 0.1975, -0.168898, -0.0771997, 0.1375, 0.0037381, -0.181406,
<a class="jxr_linenumber" name="L29" href="#L29">29</a>                      -0.0092101, -0.2825, -0.1308451, 0.3631068, 0.1254114, -0.1954517, 0.0911673, 0.10240356,
<a class="jxr_linenumber" name="L30" href="#L30">30</a>                      -0.3023037, 0.1355385, -0.0056466, -0.413843, -0.1875, 0.0926308, -0.1479074, 0.06556973, -0.0725,
<a class="jxr_linenumber" name="L31" href="#L31">31</a>                      -0.25387882, 0.127806, -0.0295907, -0.1925, 0.06278483, 0.0711183, -0.0411272, -0.0400874,
<a class="jxr_linenumber" name="L32" href="#L32">32</a>                      -0.1625113, 0.1590156, 0.0034054, -0.1999182, 0.00257759, -0.3575, -0.1925, -0.2993746, -0.2825,
<a class="jxr_linenumber" name="L33" href="#L33">33</a>                      -0.6041969, -0.7925},
<a class="jxr_linenumber" name="L34" href="#L34">34</a>              {0.3275, -0.1663107, -0.0225, -0.1228114, 0.1470665, -0.1036745, -0.1025, -0.2047299, 0.0638829,
<a class="jxr_linenumber" name="L35" href="#L35">35</a>                      -0.16133117, 0.1632783, -0.0444952, 0.2680172, 0.3475548, 0.0295439, -0.6875008, -0.061364,
<a class="jxr_linenumber" name="L36" href="#L36">36</a>                      -0.0796302, -0.1457953, 0.1598082, 0.0525, -0.0257534, -0.0825, 0.0366608, -0.196249, -0.0975,
<a class="jxr_linenumber" name="L37" href="#L37">37</a>                      -0.0946822, 0.10830705, 0.147723, 0.1434783, 0.07348083, 0.1207932, -0.0673457, -0.0126779,
<a class="jxr_linenumber" name="L38" href="#L38">38</a>                      -0.1352822, -0.0575, -0.110774, -0.0759109, 0.0377492, -0.0225, 0.1080423, 0.0425, -0.2725,
<a class="jxr_linenumber" name="L39" href="#L39">39</a>                      -0.1684038, -0.5088469, -0.0925},
<a class="jxr_linenumber" name="L40" href="#L40">40</a>              {-0.4625, 0.1775, -0.1725, 0.1225, -0.0688769, -0.0825, 0.0413575, 0.1200126, 0.1254245, -0.0512794,
<a class="jxr_linenumber" name="L41" href="#L41">41</a>                      -0.0608441, -0.1845481, -0.392909, -0.1240293, 0.4066574, 0.4194054, -0.2511903, -0.2825, -0.1625,
<a class="jxr_linenumber" name="L42" href="#L42">42</a>                      -0.0475, -0.5575, -0.2675, -0.1325, -0.1325, 0.206819, -0.0575, -0.0222567, 0.1475, 0.0825,
<a class="jxr_linenumber" name="L43" href="#L43">43</a>                      0.060201, 0.1975, 0.0308863, 0.1025, -0.0225, -0.013667, -0.1670427, 0.0896259, -0.115672,
<a class="jxr_linenumber" name="L44" href="#L44">44</a>                      0.0252131, -0.1975, -0.107063, 0.4275, -0.0075, -0.1110737, -0.4725, -0.5925},
<a class="jxr_linenumber" name="L45" href="#L45">45</a>              {-0.083547, -0.132534, 0.014395, -0.1225, 0.149054, -0.3675, 0.208037, -0.3625, 0.0121713, -0.08756715,
<a class="jxr_linenumber" name="L46" href="#L46">46</a>                      0.1986281, -0.1412442, 0.0557431, 0, 0, 0, 0, 0, 0, 0, 0, 0, -0.2875, -0.215435, -0.0775,
<a class="jxr_linenumber" name="L47" href="#L47">47</a>                      -0.1579732, -0.00370849, 0.0925, -0.3175, 0.1575, 0.0175, 0.068356, 0.0275, 0.0796036, -0.0552551,
<a class="jxr_linenumber" name="L48" href="#L48">48</a>                      0.018586, -0.0571336, 0.0608483, -0.247937552, 0.0272649, 0.03010379, -0.0783827, -0.0075, -0.3025,
<a class="jxr_linenumber" name="L49" href="#L49">49</a>                      0.3875, -0.58198},
<a class="jxr_linenumber" name="L50" href="#L50">50</a>              {-0.6075, -0.093355, -0.0969671, -0.2175, 0.0325, -0.031956, -0.0829451, 0.0503807, -0.2241145, -0.0359618,
<a class="jxr_linenumber" name="L51" href="#L51">51</a>                      0.0506417, -0.1239427, 0.1893141, 0, 0, 0, 0, 0, 0, 0, 0, 0, -0.4325, -0.2675, -0.217103,
<a class="jxr_linenumber" name="L52" href="#L52">52</a>                      -0.0616863, 0.1101912, -0.060917, -0.0835527, 0.0575, 0.0475, -0.009147, 0.0578838, 0.0069627,
<a class="jxr_linenumber" name="L53" href="#L53">53</a>                      0.0408659, -0.0513671, -0.0112259, 0.1110902, -0.1720962, -0.1180274, 0.06871907, -0.0025,
<a class="jxr_linenumber" name="L54" href="#L54">54</a>                      -0.0862501, -0.2354536, -0.3075, -1.417194},
<a class="jxr_linenumber" name="L55" href="#L55">55</a>              {0.1194706, -0.08041988, -0.1077863, 0.1481893, -0.0641751, -0.051378, -0.04136388, -0.1575, 0.0081597,
<a class="jxr_linenumber" name="L56" href="#L56">56</a>                      -0.0701061, 0.0086603, -0.14962, -0.1954328, 0.0148327, 0.2521256, -0.16912103, -0.1175, 0.0375,
<a class="jxr_linenumber" name="L57" href="#L57">57</a>                      0.8873608, -0.224069, -0.0128892, -0.2875, -0.1075, 0.0375, -0.058814, -0.0133626, 0.1475,
<a class="jxr_linenumber" name="L58" href="#L58">58</a>                      0.173321, 0.0825, 0.040546, 0.041709, 0.0251368, -0.0575, -0.1136101, -0.0301162, -0.1125, 0.0225,
<a class="jxr_linenumber" name="L59" href="#L59">59</a>                      -0.185068, -0.1474075, -0.0725, -1.6075, -0.0582114, -0.2234694, -0.2125, -0.1175, -0.172385},
<a class="jxr_linenumber" name="L60" href="#L60">60</a>              {-0.0875, 0.136129, -0.0125, -0.0875, -0.2097815, -0.1595193, -0.052444, -0.033848, 0.0675, 0.201675,
<a class="jxr_linenumber" name="L61" href="#L61">61</a>                      -0.0655129, -0.1044728, -0.0430091, 0.0122804, 0.1810478, -0.14868372, -0.10179017, -0.0092951,
<a class="jxr_linenumber" name="L62" href="#L62">62</a>                      -0.105502, -0.1542615, -0.0871289, 0.0575, -0.0925, -0.137417, -0.0774963, -0.0882555, 0.074455,
<a class="jxr_linenumber" name="L63" href="#L63">63</a>                      0.1289489, 0.09836, -0.1329085, -0.0347011, -0.0442986, -0.0592823, 0.0252948, -0.0615604,
<a class="jxr_linenumber" name="L64" href="#L64">64</a>                      -0.0998687, -0.004105, -0.2175, -0.1499061, -0.0782729, -0.0210423, -0.2695361, -0.1765748,
<a class="jxr_linenumber" name="L65" href="#L65">65</a>                      0.2169724, -0.2325, -0.1125},
<a class="jxr_linenumber" name="L66" href="#L66">66</a>              {-0.0975, 0.0975, 0.1025, 0.0175, -0.11354966, -0.23675624, -0.073492, 0.0321982, -0.1621539, 0.2106517,
<a class="jxr_linenumber" name="L67" href="#L67">67</a>                      -0.0172448, -0.0025, -0.1232094, 0.345042, -0.2896987, -0.0775987, 0.1906324, -0.1569566,
<a class="jxr_linenumber" name="L68" href="#L68">68</a>                      -0.10689543, 0.0059499, -0.3087685, -0.1575, -0.0325927, -0.133885, -0.1925, 0.0075, 0.0075,
<a class="jxr_linenumber" name="L69" href="#L69">69</a>                      0.091707, -0.004635, -0.1644798, -0.0442213, -0.2575, -0.174065, -0.3025, 0.0044777, -0.1625,
<a class="jxr_linenumber" name="L70" href="#L70">70</a>                      -0.1368078, -0.0599044, 0.0287408, -0.0914427, -0.2525, -0.189499, -0.2271684, -0.0200413,
<a class="jxr_linenumber" name="L71" href="#L71">71</a>                      -0.976364, -0.3075},
<a class="jxr_linenumber" name="L72" href="#L72">72</a>              {-0.297055, 0.008139286, -0.246493, 0.0675, -0.3725, -0.0075, -0.1475, -0.1075, -0.1125, -0.0143693,
<a class="jxr_linenumber" name="L73" href="#L73">73</a>                      0.0675, -0.2972707, 0.0116054, -0.1275, -0.1975, -0.062049, -0.0547311, -0.0377056, -0.1125,
<a class="jxr_linenumber" name="L74" href="#L74">74</a>                      -0.1845299, -0.1075, 0.1969785, -0.2471708, -0.0764265, 0.184715, 0.067933, -0.082235, -0.0425,
<a class="jxr_linenumber" name="L75" href="#L75">75</a>                      -0.2225, 0.0756024, -0.1075, -0.0371792, -0.0775, -0.111122, -0.15117577, -0.0425, -0.1575,
<a class="jxr_linenumber" name="L76" href="#L76">76</a>                      -0.0008167, -0.1500484, -0.4225, -0.0706456, -0.0326774, -0.3875, -0.3925, -0.4975, -0.6075}};
<a class="jxr_linenumber" name="L77" href="#L77">77</a>  
<a class="jxr_linenumber" name="L78" href="#L78">78</a>      <em class="jxr_comment">// Call the offset, correct the time, and set the time</em>
<a class="jxr_linenumber" name="L79" href="#L79">79</a>      <strong class="jxr_keyword">public</strong> <strong class="jxr_keyword">void</strong> process(EventHeader event) {
<a class="jxr_linenumber" name="L80" href="#L80">80</a>  
<a class="jxr_linenumber" name="L81" href="#L81">81</a>          <em class="jxr_comment">// Get the hits in the event</em>
<a class="jxr_linenumber" name="L82" href="#L82">82</a>          List&lt;CalorimeterHit&gt; hits = event.get(CalorimeterHit.<strong class="jxr_keyword">class</strong>, <span class="jxr_string">"EcalCalHits"</span>);
<a class="jxr_linenumber" name="L83" href="#L83">83</a>  
<a class="jxr_linenumber" name="L84" href="#L84">84</a>          <strong class="jxr_keyword">for</strong> (CalorimeterHit iHit : hits) {
<a class="jxr_linenumber" name="L85" href="#L85">85</a>              <strong class="jxr_keyword">double</strong> oldT = iHit.getTime();
<a class="jxr_linenumber" name="L86" href="#L86">86</a>              <strong class="jxr_keyword">int</strong> ix = iHit.getIdentifierFieldValue(<span class="jxr_string">"ix"</span>);
<a class="jxr_linenumber" name="L87" href="#L87">87</a>              <strong class="jxr_keyword">int</strong> iy = iHit.getIdentifierFieldValue(<span class="jxr_string">"iy"</span>);
<a class="jxr_linenumber" name="L88" href="#L88">88</a>  
<a class="jxr_linenumber" name="L89" href="#L89">89</a>              <strong class="jxr_keyword">if</strong> (ix &gt;= 0) {
<a class="jxr_linenumber" name="L90" href="#L90">90</a>                  ix -= 1;
<a class="jxr_linenumber" name="L91" href="#L91">91</a>              }
<a class="jxr_linenumber" name="L92" href="#L92">92</a>              <strong class="jxr_keyword">if</strong> (iy &gt;= 0) {
<a class="jxr_linenumber" name="L93" href="#L93">93</a>                  iy -= 1;
<a class="jxr_linenumber" name="L94" href="#L94">94</a>              }
<a class="jxr_linenumber" name="L95" href="#L95">95</a>              <strong class="jxr_keyword">double</strong> toffset = OFFSETS[iy + 5][ix + 23];
<a class="jxr_linenumber" name="L96" href="#L96">96</a>              ((BaseCalorimeterHit) iHit).setTime(oldT - toffset);
<a class="jxr_linenumber" name="L97" href="#L97">97</a>              <em class="jxr_comment">// System.out.println("old time\t"+oldT+"\t offset\t"+toffset+"\tix\t"+ix+"\tiy\t"+iy);</em>
<a class="jxr_linenumber" name="L98" href="#L98">98</a>  
<a class="jxr_linenumber" name="L99" href="#L99">99</a>          }
<a class="jxr_linenumber" name="L100" href="#L100">100</a>     }
<a class="jxr_linenumber" name="L101" href="#L101">101</a> }
</pre>
<hr/>
<div id="footer">Copyright &#169; 2023 <a href="https://confluence.slac.stanford.edu/display/hpsg/Heavy+Photon+Search+Experiment">Heavy Photon Search (HPS)</a>. All rights reserved.</div>
</body>
</html>